<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
#map {
    height: 100%;
    width: 100%;
    margin: auto;
    margin: auto;
}

html, body {
    height: 100%;
    margin: 0;
    padding: 0;
}
</style>
    
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAialOco_QZ9EpqMxzYqqkkpQDza4ENv-Y&callback=initMap"></script>
<script type="text/javascript">
    var map;
    var infowindow;
</script>

<script>
      // New map
      var map = null;
      var bounds = null;

      var directionsService = null;
      var directionsDisplay = null;

      // Add Marker Function
      function addMarker(map, props){
        var marker = new google.maps.Marker({
          position:props.coords,
          map:map
          //icon:props.iconImage
        });

        // Check for customicon
        if(props.iconImage){
          // Set icon image
          marker.setIcon(props.iconImage);
        }

        // Check content
        if(props.content){
          var infoWindow = new google.maps.InfoWindow({
            content:props.content
          });

          marker.addListener('click', function(){
            toMarker(props);
          });
        }
      }
      
    function toMarker(props)
    {
      console.log(props);
      latLng = new google.maps.LatLng(-41.295548,174.775604);

      dest = new google.maps.LatLng(props.coords.lat, props.coords.lng);

      directionsService.route({
          origin: latLng,
          destination: dest,
          travelMode: 'DRIVING'
        }, function(response, status) {
          if (status === 'OK') {
            directionsDisplay.setDirections(response);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
    }

    function initMap()
    {
      // Map options
      directionsService = new google.maps.DirectionsService;
      directionsDisplay = new google.maps.DirectionsRenderer;
      var options = {
        zoom:12,
        center:{lat:-41.286460,lng:174.776236}
      }

       map = new google.maps.Map(document.getElementById('map'), options);
      bounds = new google.maps.LatLngBounds();

    directionsDisplay.setMap(map);

      // Listen for click on map
      google.maps.event.addListener(map, 'click', function(event){
        // Add marker
        addMarker({coords:event.latLng});
      });

      // Array of markers
      var markers = [
        {
          coords:{lat:-41.293783,lng:174.761291},
          content:'<h1>Polhill Reserve Loop</h1>'
        },
      ];

      // Loop through markers
      for(var i = 0;i < markers.length;i++){
        // Add marker
        addMarker(map,markers[i]);
  bounds.extend(markers[i].coords);

      }

      map.fitBounds(bounds);
    }

// ================ user location ================ //

function findMyCurrentLocation() {
  var geoService = navigator.geolocation;
  if (geoService) {
    geoService.getCurrentPosition(showCurrentLocation,errorHandler,{enableHighAccuracy: true});
  } else {
    alert("Your Browser does not support GeoLocation.");
  }
}

function showCurrentLocation(position){
  //Convert position -> Lat/Lon object
  var latLng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);

  var usermarker = {
    coords:latLng,
  };

  addMarker(map, usermarker);

  bounds.extend(usermarker.coords);

  map.fitBounds(bounds);
}

function errorHandler(error){
    alert("Error while retrieving current position. Error code: " + error.code + ",Message: " + error.message);
}

// ================ directions ================ //
      
var onChangeHandler = function() {
    calculateAndDisplayRoute(directionsService, directionsDisplay);
    };
    document.getElementById('start').addEventListener('change', onChangeHandler);
    document.getElementById('end').addEventListener('change', onChangeHandler);

      function calculateAndDisplayRoute(directionsService, directionsDisplay) {
        directionsService.route({
          origin: document.getElementById('start').value,
          destination: document.getElementById('end').value,
          travelMode: 'DRIVING'
        }, function(response, status) {
          if (status === 'OK') {
            directionsDisplay.setDirections(response);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }
</script>
</head>
    
<body onload="findMyCurrentLocation()">

    <div id="map"></div>

</body>
<footer>MDDN352 Kristina Huang</footer>

</html>


